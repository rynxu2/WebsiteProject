<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .cart-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .quantity-input {
            width: 50px;
            text-align: center;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-out {
            animation: slideOut 0.3s ease-in-out forwards;
        }
        @keyframes slideOut {
            to { opacity: 0; transform: translateX(100px); height: 0; padding: 0; margin: 0; border: none; }
        }
        .loading-spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid #6366f1;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-indigo-700">Shopping Cart Management</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Product List Section -->
            <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Available Products</h2>
                <div class="mb-4">
                    <input type="text" id="search-product" placeholder="Search products..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div id="product-list" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- Products will be loaded here -->
                    <div class="flex justify-center py-4">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>
            
            <!-- Shopping Cart Section -->
            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">Your Shopping Cart</h2>
                    <span id="cart-count" class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">0 items</span>
                </div>
                
                <div id="cart-items" class="space-y-4 mb-6">
                    <!-- Cart items will be loaded here -->
                    <div id="empty-cart-message" class="text-center py-10 text-gray-500">
                        <i class="fas fa-shopping-cart text-4xl mb-3"></i>
                        <p>Your cart is empty</p>
                    </div>
                </div>
                
                <div class="border-t pt-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-medium text-gray-700">Subtotal:</span>
                        <span id="subtotal" class="font-medium">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center mb-4">
                        <span class="font-medium text-gray-700">Shipping:</span>
                        <span class="font-medium">Free</span>
                    </div>
                    <div class="flex justify-between items-center text-lg font-bold">
                        <span>Total:</span>
                        <span id="total" class="text-indigo-600">$0.00</span>
                    </div>
                    
                    <button id="checkout-btn" class="w-full mt-6 bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-4 rounded-lg font-medium transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // Global variables
            let products = [];
            let cart = [];
            
            // DOM elements
            const productListEl = $('#product-list');
            const cartItemsEl = $('#cart-items');
            const emptyCartMessageEl = $('#empty-cart-message');
            const cartCountEl = $('#cart-count');
            const subtotalEl = $('#subtotal');
            const totalEl = $('#total');
            const checkoutBtnEl = $('#checkout-btn');
            const searchProductEl = $('#search-product');
            
            // API base URL
            const API_BASE_URL = 'https://67ff87cd58f18d7209f19525.mockapi.io/api/v1/products';
            
            // Initialize the app
            init();
            
            function init() {
                loadProducts();
                loadCartFromLocalStorage();
                renderCart();
                
                // Event listeners
                searchProductEl.on('input', filterProducts);
            }
            
            // Load products from API
            function loadProducts() {
                showLoading(productListEl);
                
                $.ajax({
                    url: API_BASE_URL,
                    method: 'GET',
                    success: function(data) {
                        products = data;
                        renderProducts(products);
                    },
                    error: function(error) {
                        console.error('Error loading products:', error);
                        // Fallback to sample data if API fails
                        products = getSampleProducts();
                        renderProducts(products);
                    }
                });
            }
            
            // Show loading spinner
            function showLoading(element) {
                element.html('<div class="flex justify-center py-4"><div class="loading-spinner"></div></div>');
            }
            
            // Sample data fallback
            // function getSampleProducts() {
            //     return [
            //         {
            //             id: '1',
            //             title: 'Wireless Headphones',
            //             description: 'Premium noise-cancelling wireless headphones',
            //             price: '199.99',
            //             image: 'https://via.placeholder.com/150',
            //             createdAt: '2023-01-15T10:30:00Z'
            //         },
            //         {
            //             id: '2',
            //             title: 'Smart Watch',
            //             description: 'Fitness tracking and notifications',
            //             price: '249.99',
            //             image: 'https://via.placeholder.com/150',
            //             createdAt: '2023-02-20T14:45:00Z'
            //         },
            //         {
            //             id: '3',
            //             title: 'Bluetooth Speaker',
            //             description: 'Portable waterproof speaker',
            //             price: '89.99',
            //             image: 'https://via.placeholder.com/150',
            //             createdAt: '2023-03-05T09:15:00Z'
            //         },
            //         {
            //             id: '4',
            //             title: 'Laptop Backpack',
            //             description: 'Ergonomic backpack with USB charging port',
            //             price: '59.99',
            //             image: 'https://via.placeholder.com/150',
            //             createdAt: '2023-03-10T11:20:00Z'
            //         },
            //         {
            //             id: '5',
            //             title: 'Wireless Mouse',
            //             description: 'Ergonomic wireless mouse with silent clicks',
            //             price: '29.99',
            //             image: 'https://via.placeholder.com/150',
            //             createdAt: '2023-03-15T16:30:00Z'
            //         }
            //     ];
            // }
            
            // Render products list
            function renderProducts(productsToRender) {
                productListEl.empty();
                
                if (productsToRender.length === 0) {
                    productListEl.append('<p class="text-gray-500">No products found</p>');
                    return;
                }
                
                productsToRender.forEach(product => {
                    const productEl = $(`
                        <div class="product-item bg-gray-50 p-4 rounded-lg flex items-center space-x-4 hover:bg-gray-100 transition duration-200 cursor-pointer">
                            <img src="${product.image}" alt="${product.title}" class="w-16 h-16 object-cover rounded">
                            <div class="flex-1">
                                <h3 class="font-medium text-gray-800">${product.title}</h3>
                                <p class="text-sm text-gray-600">$${parseFloat(product.price).toFixed(2)}</p>
                            </div>
                            <button class="add-to-cart-btn bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700 transition duration-200" data-id="${product.id}">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    `);
                    
                    productEl.find('.add-to-cart-btn').click(() => addToCart(product.id));
                    productListEl.append(productEl);
                });
            }
            
            // Filter products based on search input
            function filterProducts() {
                const searchTerm = searchProductEl.val().toLowerCase();
                const filteredProducts = products.filter(product => 
                    product.title.toLowerCase().includes(searchTerm) || 
                    product.description.toLowerCase().includes(searchTerm)
                );
                renderProducts(filteredProducts);
            }
            
            // Add product to cart
            function addToCart(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                const existingItem = cart.find(item => item.id === productId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                    updateCartItemInAPI(existingItem);
                } else {
                    const newItem = {
                        id: product.id,
                        title: product.title,
                        price: parseFloat(product.price),
                        image: product.image,
                        quantity: 1
                    };
                    cart.push(newItem);
                    addCartItemToAPI(newItem);
                }
                
                saveCartToLocalStorage();
                renderCart();
                
                // Show success feedback
                const btn = $(`.add-to-cart-btn[data-id="${productId}"]`);
                btn.html('<i class="fas fa-check"></i>');
                btn.removeClass('bg-indigo-600 hover:bg-indigo-700').addClass('bg-green-500 hover:bg-green-600');
                
                setTimeout(() => {
                    btn.html('<i class="fas fa-plus"></i>');
                    btn.removeClass('bg-green-500 hover:bg-green-600').addClass('bg-indigo-600 hover:bg-indigo-700');
                }, 1000);
            }
            
            // Add cart item to API
            function addCartItemToAPI(item) {
                $.ajax({
                    url: API_BASE_URL,
                    method: 'POST',
                    data: {
                        title: item.title,
                        price: item.price,
                        image: item.image,
                        quantity: item.quantity
                    },
                    success: function(response) {
                        console.log('Item added to API:', response);
                    },
                    error: function(error) {
                        console.error('Error adding item to API:', error);
                    }
                });
            }
            
            // Update cart item in API
            function updateCartItemInAPI(item) {
                $.ajax({
                    url: `${API_BASE_URL}/${item.id}`,
                    method: 'PUT',
                    data: {
                        quantity: item.quantity
                    },
                    success: function(response) {
                        console.log('Item updated in API:', response);
                    },
                    error: function(error) {
                        console.error('Error updating item in API:', error);
                    }
                });
            }
            
            // Remove product from cart
            function removeFromCart(productId) {
                const item = cart.find(item => item.id === productId);
                if (!item) return;
                
                cart = cart.filter(item => item.id !== productId);
                removeCartItemFromAPI(productId);
                saveCartToLocalStorage();
                renderCart();
            }
            
            // Remove cart item from API
            function removeCartItemFromAPI(productId) {
                $.ajax({
                    url: `${API_BASE_URL}/${productId}`,
                    method: 'DELETE',
                    success: function(response) {
                        console.log('Item removed from API:', response);
                    },
                    error: function(error) {
                        console.error('Error removing item from API:', error);
                    }
                });
            }
            
            // Update product quantity in cart
            function updateQuantity(productId, newQuantity) {
                const item = cart.find(item => item.id === productId);
                if (!item) return;
                
                newQuantity = parseInt(newQuantity);
                if (isNaN(newQuantity) || newQuantity < 1) {
                    newQuantity = 1;
                }
                
                item.quantity = newQuantity;
                updateCartItemInAPI(item);
                saveCartToLocalStorage();
                renderCart();
            }
            
            // Render cart items
            function renderCart() {
                if (cart.length === 0) {
                    emptyCartMessageEl.show();
                    cartCountEl.text('0 items');
                    subtotalEl.text('$0.00');
                    totalEl.text('$0.00');
                    checkoutBtnEl.prop('disabled', true);
                    return;
                }
                
                emptyCartMessageEl.hide();
                cartItemsEl.empty();
                
                let subtotal = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    
                    const cartItemEl = $(`
                        <div class="cart-item bg-gray-50 p-4 rounded-lg flex flex-col md:flex-row md:items-center gap-4 transition duration-200 fade-in">
                            <img src="${item.image}" alt="${item.title}" class="w-16 h-16 object-cover rounded self-start">
                            <div class="flex-1">
                                <h3 class="font-medium text-gray-800">${item.title}</h3>
                                <p class="text-sm text-gray-600">$${item.price.toFixed(2)}</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button class="decrease-quantity bg-gray-200 hover:bg-gray-300 text-gray-800 p-1 rounded" data-id="${item.id}">
                                    <i class="fas fa-minus text-xs"></i>
                                </button>
                                <input type="number" value="${item.quantity}" min="1" class="quantity-input border rounded py-1 px-2" data-id="${item.id}">
                                <button class="increase-quantity bg-gray-200 hover:bg-gray-300 text-gray-800 p-1 rounded" data-id="${item.id}">
                                    <i class="fas fa-plus text-xs"></i>
                                </button>
                            </div>
                            <div class="font-medium text-gray-800">$${itemTotal.toFixed(2)}</div>
                            <button class="remove-item text-red-500 hover:text-red-700 p-2" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `);
                    
                    // Add event listeners
                    cartItemEl.find('.decrease-quantity').click(() => {
                        const newQuantity = item.quantity - 1;
                        if (newQuantity >= 1) {
                            updateQuantity(item.id, newQuantity);
                        }
                    });
                    
                    cartItemEl.find('.increase-quantity').click(() => {
                        updateQuantity(item.id, item.quantity + 1);
                    });
                    
                    cartItemEl.find('.quantity-input').change(function() {
                        updateQuantity(item.id, $(this).val());
                    });
                    
                    cartItemEl.find('.remove-item').click(() => {
                        cartItemEl.addClass('slide-out');
                        setTimeout(() => removeFromCart(item.id), 300);
                    });
                    
                    cartItemsEl.append(cartItemEl);
                });
                
                // Update summary
                cartCountEl.text(`${cart.length} ${cart.length === 1 ? 'item' : 'items'}`);
                subtotalEl.text(`$${subtotal.toFixed(2)}`);
                totalEl.text(`$${subtotal.toFixed(2)}`);
                checkoutBtnEl.prop('disabled', false);
            }
            
            // Save cart to localStorage
            function saveCartToLocalStorage() {
                localStorage.setItem('shoppingCart', JSON.stringify(cart));
            }
            
            // Load cart from localStorage
            function loadCartFromLocalStorage() {
                const savedCart = localStorage.getItem('shoppingCart');
                if (savedCart) {
                    cart = JSON.parse(savedCart);
                }
            }
            
            // Checkout button handler
            checkoutBtnEl.click(function() {
                if (cart.length === 0) return;
                
                // Here you would typically send the cart data to your backend
                alert(`Order placed successfully! Total: $${totalEl.text()}`);
                
                // Clear cart after checkout
                cart.forEach(item => {
                    removeCartItemFromAPI(item.id);
                });
                
                cart = [];
                saveCartToLocalStorage();
                renderCart();
            });
        });
    </script>
</body>
</html>